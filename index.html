<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/2.0.1/aframe/build/aframe-ar.min.js"></script>
  </head>
  <body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs>
      
      <a-marker preset="hiro">
        <!-- 星たち -->
        <a-entity id="stars" position="0 5 0"></a-entity>

        <!-- 流れ星 -->
        <a-entity id="shootingStar" geometry="primitive: sphere; radius: 0.03" 
                  material="color: #FFD700; emissive: #FFD700; emissiveIntensity: 2"
                  position="0 5 0" visible="false">
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // 星をたくさん生成
      document.addEventListener('DOMContentLoaded', function () {
        const stars = document.getElementById('stars');
        const numStars = 100;

        for (let i = 0; i < numStars; i++) {
          const star = document.createElement('a-sphere');
          const posX = (Math.random() - 0.5) * 20;
          const posY = Math.random() * 10;
          const posZ = (Math.random() - 0.5) * 20;
          star.setAttribute('position', `${posX} ${posY} ${posZ}`);
          const size = 0.01 + Math.random() * 0.02;
          star.setAttribute('radius', size);
          star.setAttribute('color', '#FFFFFF');
          star.setAttribute('material', 'emissive: #FFFFFF; emissiveIntensity: 1');
          stars.appendChild(star);
        }

        // 流れ星の動き
        const shootingStar = document.getElementById('shootingStar');

        function spawnShootingStar() {
          // ランダムなスタート位置
          const startX = (Math.random() - 0.5) * 10;
          const startY = 8 + Math.random() * 2; // 上の方から
          const startZ = (Math.random() - 0.5) * 10;
          shootingStar.setAttribute('position', `${startX} ${startY} ${startZ}`);
          shootingStar.setAttribute('visible', 'true');

          // ランダムな移動先
          const endX = startX + (Math.random() - 0.5) * 5;
          const endY = startY - (Math.random() * 5);
          const endZ = startZ + (Math.random() - 0.5) * 5;

          // 移動アニメーション
          shootingStar.setAttribute('animation', {
            property: 'position',
            to: `${endX} ${endY} ${endZ}`,
            dur: 1000,   // 1秒で移動
            easing: 'linear'
          });

          // 移動が終わったら非表示
          setTimeout(() => {
            shootingStar.setAttribute('visible', 'false');
          }, 1000);
        }

        // ランダムな間隔で流れ星を発生
        setInterval(() => {
          if (Math.random() < 0.5) { // 50%の確率で出現
            spawnShootingStar();
          }
        }, 3000); // 3秒ごとにチャンス
      });
    </script>
  </body>
</html>
